{% extends "base.html" %}
{% load wagtailcore_tags %}
{% block content %}
    <h1>
        {{ page.title }}
    </h1>

    {{ page.specific.intro|richtext }}
    <div class="row">
        <div class="col-4">
            <div class="card mb-2">
                <div class="card-body">
                    <h2 class="card-title">Facets</h2>
                </div>
                <form id="facetForm" class="mx-2">
                    <div class="form-group">
                        <label for="audience">
                            Author
                        </label>
                        <select class="form-control" name="authors__author__title" id="author">
                            <option selected disabled hidden>Select...</option>
                            {% for author in authors %}
                                <option>{{ author }}</option>
                            {% endfor %}
                        </select>
                        <hr />
                        <label for="audience">
                            Audience
                        </label>
                        <select class="form-control" name="item_audience__title" id="audience">
                            <option selected disabled hidden>Select...</option>
                            {% for audience in audiences %}
                                <option>{{ audience }}</option>
                            {% endfor %}
                        </select>
                        <hr />
                        <label for="genre">
                            Genre
                        </label>
                        <select class="form-control" name="item_genre__title" id="genre">
                            <option disabled selected>Select...</option>
                            {% for genre in genres %}
                                <option>{{ genre }}</option>
                            {% endfor %}
                        </select>
                        <hr />
                        <label for="medium">
                            Medium
                        </label>
                        <select class="form-control" name="item_medium__title" id="medium">
                            <option disabled selected>Select...</option>
                            {% for medium in mediums %}
                                <option>{{ medium }}</option>
                            {% endfor %}
                        </select>
                        <hr />
                        <label for="time_period">
                            Time Period
                        </label>
                        <select class="form-control" name="item_time_period__title" id="time_period">
                            <option disabled selected>Select...</option>
                            {% for time_period in time_periods %}
                                <option>{{ time_period }}</option>
                            {% endfor %}
                        </select>
                        <hr />
                        <label for="topic">
                            Topic
                        </label>
                        <select class="form-control" name="topic" id="topic">
                            <option disabled selected>Select...</option>
                            {% for topic in topics %}
                                <option>{{ topic }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
        </div>
        <div class="col" id="app">
            {% if library_items %}
                {% for library_item in library_items %}
                <div class="card mb-2">
                    <div class="card-body">
                        <h3>
                            <a href="{% pageurl library_item %}">
                                {{ library_item }}
                            </a>
                        </h3>
                        Authored by:
                        {% for author in library_item.specific.authors.all %}
                            <a href="{% pageurl author.author %}">{{ author.author }}</a>{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}

            {% else %}
                <p>No media items found.</p>
            {% endif %}
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
<script>
    // Submit form when any option is selected
    document.getElementById("facetForm").addEventListener("change", function () {
        this.submit();
    });

    // Keep search facets in-sync with url parameters
    var urlParams = new URLSearchParams(window.location.search);

    // get facet url params
    var facets = {
        author: urlParams.get('authors__author__title'),
        audience: urlParams.get('item_audience__title'),
        genre: urlParams.get('item_genre__title'),
        medium: urlParams.get('item_medium__title'),
        time_period: urlParams.get('item_time_period__title'),
        topic: urlParams.get('item_topic__title'),
    };

    // check whether each facet is contained in URL querystring
    // if so, update corresponding select element
    for (var facet in facets) {
        if (facets[facet]) document.getElementById(facet).value=facets[facet];
    }
</script>
{% endblock %}