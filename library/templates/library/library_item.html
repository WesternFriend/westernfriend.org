{% extends "base.html" %}

{% load wagtailcore_tags %}

{% block body_class %}template-libraryitem{% endblock %}

{% block content %}
    <h1>
        {{ page.title }}
    </h1>

    Authored by:
    {% for author in page.specific.authors.all %}
        {% if author.author.live %}
            <a href="{% pageurl author.author %}">{{ author.author }}</a>{% if not forloop.last %},{% endif %}
        {% else %}
            {{ author.author }}{% if not forloop.last %},{% endif %}
        {% endif %}
    {% endfor %}

    {% include_block page.body %}

    <dl class="mt-3">
        {% if page.specific.item_audience  %}
            <dt>
                Audience:
            </dt>
            <dd>
                <a href="{% pageurl page.specific.item_audience %}">
                    {{ page.specific.item_audience }}
                </a>
            </dd>
        {% endif %}

        {% if page.specific.item_genre  %}
            <dt>
                Genre:
            </dt>
            <dd>
                <a href="{% pageurl page.specific.item_genre %}">
                    {{ page.specific.item_genre }}
                </a>
            </dd>
        {% endif %}

        {% if page.specific.item_medium  %}
            <dt>
                Medium:
            </dt>
            <dd>
                <a href="{% pageurl page.specific.item_medium %}">
                    {{ page.specific.item_medium }}
                </a>
            </dd>
        {% endif %}

        {% if page.specific.item_time_period  %}
            <dt>
                Time period:
            </dt>
            <dd>
                <a href="{% pageurl page.specific.item_time_period %}">
                    {{ page.specific.item_time_period }}
                </a>
            </dd>
        {% endif %}

        {% if page.specific.topics.count  %}
            <dt>
                Topic
            </dt>

            <dd>
                {% for topic in page.specific.topics.all %}
                    <a href="{% pageurl topic.topic %}">
                        {{ topic.topic }}
                    </a>{% if not forloop.last %},{% endif %}
                {% endfor %}
            </dd>
        {% endif %}

        {% if page.tags.count  %}
            <div class="tags">
                {% for tag in page.tags.all %}
                    <a
                        href="{%url 'tags:tagged_page_list' tag.slug %}"
                        class="btn btn-outline-primary btn-sm">
                        {{ tag }}
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    </dl>
{% endblock %}

{{% block extra_js %}
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CreativeWork",
      "name": "{{ page.title }}",
      {% if page.specific.authors.count %}
      "author": [
        {% for author in page.specific.authors.all %}
        {
          "@type": "{% if author.author.specific_class_name == 'Person' %}Person{% elif author.author.specific_class_name == 'Organization' or author.author.specific_class_name == 'Meeting' %}Organization{% else %}Thing{% endif %}",
          "name": "{{ author.author.title }}"
          {% if author.author.specific_class_name == 'Person' %}
          ,"givenName": "{{ author.author.specific.given_name }}",
          "familyName": "{{ author.author.specific.family_name }}"
          {% endif %}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
      ],
      {% endif %}
      {% if page.specific.publication_date %}
      "datePublished": "{{ page.specific.publication_date|date:"Y-m-d" }}",
      {% endif %}
      {% if page.specific.item_audience %}
      "audience": {
        "@type": "Audience",
        "name": "{{ page.specific.item_audience.title }}"
      },
      {% endif %}
      {% if page.specific.item_genre %}
      "genre": "{{ page.specific.item_genre.title }}",
      {% endif %}
      {% if page.specific.item_medium %}
      "encodingFormat": "{{ page.specific.item_medium.title }}",
      {% endif %}
      {% if page.specific.item_time_period %}
      "temporalCoverage": "{{ page.specific.item_time_period.title }}",
      {% endif %}
      {% if page.specific.topics.count %}
      "about": [
        {% for topic in page.specific.topics.all %}
        "{{ topic.topic.title }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
      ],
      {% endif %}
      {% if page.tags.count %}
      "keywords": [
        {% for tag in page.tags.all %}
        "{{ tag }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
      ],
      {% endif %}
      "url": "{{ page.full_url }}"
    }
</script>

{% endblock extra_js %}}
